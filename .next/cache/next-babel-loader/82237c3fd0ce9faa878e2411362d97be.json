{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/esm/inherits\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nvar _jsxFileName = \"/home/hrishib/Desktop/prototype/pages/posts/new.js\";\nvar __jsx = React.createElement;\nimport React, { Component } from \"react\";\nimport { Form, Button, Input, Image, Message } from \"semantic-ui-react\";\nimport Layout from \"../../components/Layout\";\nimport social from \"../../ethereum/social\";\nimport web3 from \"../../ethereum/web3\";\nimport ipfs from \"../../ethereum/ipfs\";\nimport { Router } from \"../../routes\";\n\nvar swearjar = require(\"swearjar\");\n\nimport COLORS from \"../../colors\";\n\nvar NewPost = /*#__PURE__*/function (_Component) {\n  _inherits(NewPost, _Component);\n\n  function NewPost() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, NewPost);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(NewPost)).call.apply(_getPrototypeOf2, [this].concat(args)));\n\n    _defineProperty(_assertThisInitialized(_this), \"state\", {\n      caption: \"\",\n      description: \"\",\n      imgBuffer: null,\n      imgIpfsHash: \"\",\n      selectedImage: \"\",\n      loading: false,\n      errMessage: \"\",\n      err: false\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onSubmit\", function _callee(event) {\n      var _this$state, description, caption, accs, date, timestamp, ipfsHash, th;\n\n      return _regeneratorRuntime.async(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              event.preventDefault();\n              _this$state = _this.state, description = _this$state.description, caption = _this$state.caption;\n\n              _this.setState({\n                loading: true,\n                errMessage: \"\"\n              });\n\n              _context.prev = 3;\n              _context.next = 6;\n              return _regeneratorRuntime.awrap(web3.eth.getAccounts());\n\n            case 6:\n              accs = _context.sent;\n              date = new Date();\n              date.setHours(date.getHours() + 5);\n              date.setMinutes(date.getMinutes() + 30);\n              timestamp = date.toUTCString().replace(\"GMT\", \"IST\");\n              console.log(_this.state.imgBuffer);\n\n              if (!(_this.state.imgBuffer != null)) {\n                _context.next = 17;\n                break;\n              }\n\n              _context.next = 15;\n              return _regeneratorRuntime.awrap(ipfs.add(_this.state.imgBuffer));\n\n            case 15:\n              ipfsHash = _context.sent;\n\n              _this.setState({\n                imgIpfsHash: ipfsHash[0].hash\n              });\n\n            case 17:\n              _context.next = 19;\n              return _regeneratorRuntime.awrap(social.methods.createPost(caption, description, _this.state.imgIpfsHash, timestamp).send({\n                from: accs[0],\n                value: web3.utils.toWei(\"0.01\", \"ether\")\n              }));\n\n            case 19:\n              th = _context.sent;\n              console.log(th.transactionHash);\n              Router.pushRoute(\"/\");\n              _context.next = 27;\n              break;\n\n            case 24:\n              _context.prev = 24;\n              _context.t0 = _context[\"catch\"](3);\n\n              _this.setState({\n                err: true,\n                errMessage: _context.t0.message\n              });\n\n            case 27:\n              _this.setState({\n                loading: false\n              });\n\n            case 28:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, null, null, [[3, 24]], Promise);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"captureFile\", function (event) {\n      event.stopPropagation();\n      event.preventDefault();\n\n      _this.setState({\n        selectedImage: URL.createObjectURL(event.target.files[0])\n      });\n\n      var file = event.target.files[0];\n      var reader = new window.FileReader();\n      reader.readAsArrayBuffer(file);\n\n      reader.onloadend = function () {\n        return _this.convertToBuffer(reader);\n      };\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"convertToBuffer\", function _callee2(reader) {\n      var buffer;\n      return _regeneratorRuntime.async(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.next = 2;\n              return _regeneratorRuntime.awrap(Buffer.from(reader.result));\n\n            case 2:\n              buffer = _context2.sent;\n\n              _this.setState({\n                imgBuffer: buffer\n              });\n\n            case 4:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    });\n\n    return _this;\n  }\n\n  _createClass(NewPost, [{\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      return __jsx(Layout, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 82\n        },\n        __self: this\n      }, __jsx(\"h3\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 83\n        },\n        __self: this\n      }, \"Create New Post\"), __jsx(\"hr\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 84\n        },\n        __self: this\n      }), __jsx(\"br\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 85\n        },\n        __self: this\n      }), __jsx(Form, {\n        onSubmit: this.onSubmit,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 86\n        },\n        __self: this\n      }, __jsx(Form.Input, {\n        fluid: true,\n        label: \"Caption\",\n        value: this.state.caption,\n        onChange: function onChange(event) {\n          return _this2.setState({\n            caption: event.target.value\n          });\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 87\n        },\n        __self: this\n      }), __jsx(Form.Input, {\n        label: \"Upload an Image\",\n        type: \"file\",\n        onChange: function onChange(event) {\n          return _this2.captureFile(event);\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 93\n        },\n        __self: this\n      }), __jsx(Image, {\n        src: this.state.selectedImage,\n        size: \"medium\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 98\n        },\n        __self: this\n      }), __jsx(\"br\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 99\n        },\n        __self: this\n      }), __jsx(Form.TextArea, {\n        label: \"Post Description\",\n        value: this.state.description,\n        placeholder: \"Whats Happening...\",\n        onChange: function onChange(event) {\n          return _this2.setState({\n            description: event.target.value\n          });\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 100\n        },\n        __self: this\n      }), __jsx(Message, {\n        error: true,\n        header: \"Oops!\",\n        visible: this.state.err,\n        content: this.state.errMessage,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 109\n        },\n        __self: this\n      }), __jsx(Button, {\n        icon: \"edit\",\n        content: \"Create Post\",\n        loading: this.state.loading,\n        style: {\n          backgroundColor: COLORS.menuBackground,\n          color: COLORS.menuText\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 116\n        },\n        __self: this\n      })));\n    }\n  }]);\n\n  return NewPost;\n}(Component);\n\nexport default NewPost;","map":{"version":3,"sources":["/home/hrishib/Desktop/prototype/pages/posts/new.js"],"names":["React","Component","Form","Button","Input","Image","Message","Layout","social","web3","ipfs","Router","swearjar","require","COLORS","NewPost","caption","description","imgBuffer","imgIpfsHash","selectedImage","loading","errMessage","err","event","preventDefault","state","setState","eth","getAccounts","accs","date","Date","setHours","getHours","setMinutes","getMinutes","timestamp","toUTCString","replace","console","log","add","ipfsHash","hash","methods","createPost","send","from","value","utils","toWei","th","transactionHash","pushRoute","message","stopPropagation","URL","createObjectURL","target","files","file","reader","window","FileReader","readAsArrayBuffer","onloadend","convertToBuffer","Buffer","result","buffer","onSubmit","captureFile","backgroundColor","menuBackground","color","menuText"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport { Form, Button, Input, Image, Message } from \"semantic-ui-react\";\nimport Layout from \"../../components/Layout\";\nimport social from \"../../ethereum/social\";\nimport web3 from \"../../ethereum/web3\";\nimport ipfs from \"../../ethereum/ipfs\";\nimport { Router } from \"../../routes\";\nvar swearjar = require(\"swearjar\");\nimport COLORS from \"../../colors\";\n\nclass NewPost extends Component {\n  state = {\n    caption: \"\",\n    description: \"\",\n    imgBuffer: null,\n    imgIpfsHash: \"\",\n    selectedImage: \"\",\n    loading: false,\n    errMessage: \"\",\n    err: false\n  };\n\n  onSubmit = async event => {\n    event.preventDefault();\n\n    const { description, caption } = this.state;\n\n    this.setState({ loading: true, errMessage: \"\" });\n\n    try {\n      const accs = await web3.eth.getAccounts();\n      const date = new Date();\n      date.setHours(date.getHours() + 5);\n      date.setMinutes(date.getMinutes() + 30);\n      const timestamp = date.toUTCString().replace(\"GMT\", \"IST\");\n\n      console.log(this.state.imgBuffer);\n\n      if (this.state.imgBuffer != null) {\n        const ipfsHash = await ipfs.add(this.state.imgBuffer);\n        this.setState({ imgIpfsHash: ipfsHash[0].hash });\n      }\n\n      const th = await social.methods\n        .createPost(caption, description, this.state.imgIpfsHash, timestamp)\n        .send({\n          from: accs[0],\n          value: web3.utils.toWei(\"0.01\", \"ether\")\n        });\n\n      console.log(th.transactionHash);\n      Router.pushRoute(\"/\");\n    } catch (err) {\n      this.setState({ err: true, errMessage: err.message });\n    }\n\n    this.setState({ loading: false });\n  };\n\n  captureFile = event => {\n    event.stopPropagation();\n    event.preventDefault();\n\n    this.setState({\n      selectedImage: URL.createObjectURL(event.target.files[0])\n    });\n\n    const file = event.target.files[0];\n    let reader = new window.FileReader();\n    reader.readAsArrayBuffer(file);\n    reader.onloadend = () => this.convertToBuffer(reader);\n  };\n\n  convertToBuffer = async reader => {\n    const buffer = await Buffer.from(reader.result);\n\n    this.setState({ imgBuffer: buffer });\n  };\n\n  render() {\n    return (\n      <Layout>\n        <h3>Create New Post</h3>\n        <hr />\n        <br />\n        <Form onSubmit={this.onSubmit}>\n          <Form.Input\n            fluid\n            label=\"Caption\"\n            value={this.state.caption}\n            onChange={event => this.setState({ caption: event.target.value })}\n          />\n          <Form.Input\n            label=\"Upload an Image\"\n            type=\"file\"\n            onChange={event => this.captureFile(event)}\n          />\n          <Image src={this.state.selectedImage} size=\"medium\" />\n          <br />\n          <Form.TextArea\n            label=\"Post Description\"\n            value={this.state.description}\n            placeholder=\"Whats Happening...\"\n            onChange={event =>\n              this.setState({ description: event.target.value })\n            }\n          />\n\n          <Message\n            error\n            header=\"Oops!\"\n            visible={this.state.err}\n            content={this.state.errMessage}\n          />\n\n          <Button icon=\"edit\" content=\"Create Post\" loading={this.state.loading} style={{backgroundColor:COLORS.menuBackground, color:COLORS.menuText}} />\n\n        </Form>\n      </Layout>\n    );\n  }\n}\n\nexport default NewPost;\n"]},"metadata":{},"sourceType":"module"}