{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/esm/inherits\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nvar _jsxFileName = \"/home/hrishib/Desktop/Ethegram/pages/posts/new.js\";\nvar __jsx = React.createElement;\nimport React, { Component } from \"react\";\nimport { Form, Button, Input, Image, Message, Container } from \"semantic-ui-react\";\nimport Layout from \"../../components/Layout\";\nimport social from \"../../ethereum/social\";\nimport web3 from \"../../ethereum/web3\";\nimport ipfs from \"../../ethereum/ipfs\";\nimport { Router } from \"../../routes\";\nimport COLORS from \"../../colors\";\nimport ReactPlayer from \"react-player\";\n\nvar NewPost = /*#__PURE__*/function (_Component) {\n  _inherits(NewPost, _Component);\n\n  function NewPost() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, NewPost);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(NewPost)).call.apply(_getPrototypeOf2, [this].concat(args)));\n\n    _defineProperty(_assertThisInitialized(_this), \"state\", {\n      caption: \"\",\n      description: \"\",\n      imgBuffer: null,\n      imgIpfsHash: \"\",\n      selectedImage: \"\",\n      loading: false,\n      errMessage: \"\",\n      err: false,\n      imgFlag: true,\n      vidFlag: true,\n      selectedVideo: \"\"\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onSubmit\", function _callee(event) {\n      var _this$state, description, caption, accs, date, timestamp, ipfsHash, th;\n\n      return _regeneratorRuntime.async(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              event.preventDefault();\n              console.log(_this.state.imgFlag, _this.state.vidFlag);\n              _this$state = _this.state, description = _this$state.description, caption = _this$state.caption;\n\n              _this.setState({\n                loading: true,\n                errMessage: \"\"\n              });\n\n              _context.prev = 4;\n              _context.next = 7;\n              return _regeneratorRuntime.awrap(web3.eth.getAccounts());\n\n            case 7:\n              accs = _context.sent;\n              date = new Date();\n              date.setHours(date.getHours() + 5);\n              date.setMinutes(date.getMinutes() + 30);\n              timestamp = date.toUTCString().replace(\"GMT\", \"IST\");\n              console.log(_this.state.imgBuffer);\n\n              if (!(_this.state.imgBuffer != null)) {\n                _context.next = 18;\n                break;\n              }\n\n              _context.next = 16;\n              return _regeneratorRuntime.awrap(ipfs.add(_this.state.imgBuffer));\n\n            case 16:\n              ipfsHash = _context.sent;\n\n              if (_this.state.imgFlag) {\n                _this.setState({\n                  imgIpfsHash: \"0\" + ipfsHash[0].hash\n                });\n              } else {\n                _this.setState({\n                  imgIpfsHash: \"1\" + ipfsHash[0].hash\n                });\n              }\n\n            case 18:\n              _context.next = 20;\n              return _regeneratorRuntime.awrap(social.methods.createPost(caption, description, _this.state.imgIpfsHash, timestamp).send({\n                from: accs[0],\n                value: web3.utils.toWei(\"0.01\", \"ether\")\n              }));\n\n            case 20:\n              th = _context.sent;\n              console.log(th.transactionHash);\n              Router.pushRoute(\"/\");\n              _context.next = 28;\n              break;\n\n            case 25:\n              _context.prev = 25;\n              _context.t0 = _context[\"catch\"](4);\n\n              _this.setState({\n                err: true,\n                errMessage: _context.t0.message\n              });\n\n            case 28:\n              _this.setState({\n                loading: false\n              });\n\n            case 29:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, null, null, [[4, 25]], Promise);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"captureFile\", function (event, flag) {\n      event.stopPropagation();\n      event.preventDefault();\n\n      if (flag == 0) {\n        _this.setState({\n          imgFlag: true,\n          vidFlag: false,\n          selectedImage: URL.createObjectURL(event.target.files[0])\n        });\n      } else {\n        _this.setState({\n          imgFlag: false,\n          vidFlag: true,\n          selectedVideo: URL.createObjectURL(event.target.files[0])\n        });\n      }\n\n      var file = event.target.files[0];\n      var reader = new window.FileReader();\n      reader.readAsArrayBuffer(file);\n\n      reader.onloadend = function () {\n        return _this.convertToBuffer(reader);\n      };\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"convertToBuffer\", function _callee2(reader) {\n      var buffer;\n      return _regeneratorRuntime.async(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.next = 2;\n              return _regeneratorRuntime.awrap(Buffer.from(reader.result));\n\n            case 2:\n              buffer = _context2.sent;\n\n              _this.setState({\n                imgBuffer: buffer\n              });\n\n            case 4:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    });\n\n    return _this;\n  }\n\n  _createClass(NewPost, [{\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      return __jsx(Layout, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 109\n        },\n        __self: this\n      }, __jsx(Container, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 110\n        },\n        __self: this\n      }, __jsx(\"h3\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 111\n        },\n        __self: this\n      }, \"Create New Post\"), __jsx(\"hr\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 112\n        },\n        __self: this\n      }), __jsx(\"br\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 113\n        },\n        __self: this\n      }), __jsx(Form, {\n        onSubmit: this.onSubmit,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 114\n        },\n        __self: this\n      }, __jsx(Form.Input, {\n        fluid: true,\n        label: \"Caption\",\n        value: this.state.caption,\n        onChange: function onChange(event) {\n          return _this2.setState({\n            caption: event.target.value\n          });\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 115\n        },\n        __self: this\n      }), __jsx(Form.Input, {\n        disabled: !this.state.imgFlag,\n        label: \"Click here to Upload an Image\",\n        type: \"file\",\n        onChange: function onChange(event) {\n          return _this2.captureFile(event, 0);\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 123\n        },\n        __self: this\n      }), __jsx(Image, {\n        src: this.state.selectedImage,\n        size: \"medium\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 129\n        },\n        __self: this\n      }), __jsx(\"br\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 130\n        },\n        __self: this\n      }), __jsx(Form.Input, {\n        disabled: !this.state.vidFlag,\n        label: \"Click here to Upload a Video\",\n        type: \"file\",\n        onChange: function onChange(event) {\n          return _this2.captureFile(event, 1);\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 131\n        },\n        __self: this\n      }), __jsx(ReactPlayer, {\n        hidden: this.state.selectedVideo.length == 0,\n        style: {\n          border: \"1px solid\",\n          borderColor: COLORS.black\n        },\n        url: this.state.selectedVideo,\n        playing: true,\n        controls: true,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 137\n        },\n        __self: this\n      }), __jsx(\"br\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 144\n        },\n        __self: this\n      }), __jsx(Form.TextArea, {\n        label: \"Post Description\",\n        value: this.state.description,\n        placeholder: \"Whats Happening...\",\n        onChange: function onChange(event) {\n          return _this2.setState({\n            description: event.target.value\n          });\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 145\n        },\n        __self: this\n      }), __jsx(Message, {\n        error: true,\n        header: \"Oops!\",\n        visible: this.state.err,\n        content: this.state.errMessage,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 154\n        },\n        __self: this\n      }), __jsx(Button, {\n        icon: \"edit\",\n        content: \"Create Post\",\n        loading: this.state.loading,\n        style: {\n          backgroundColor: COLORS.menuBackground,\n          color: COLORS.menuText\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 161\n        },\n        __self: this\n      }))));\n    }\n  }]);\n\n  return NewPost;\n}(Component);\n\nexport default NewPost;","map":{"version":3,"sources":["/home/hrishib/Desktop/Ethegram/pages/posts/new.js"],"names":["React","Component","Form","Button","Input","Image","Message","Container","Layout","social","web3","ipfs","Router","COLORS","ReactPlayer","NewPost","caption","description","imgBuffer","imgIpfsHash","selectedImage","loading","errMessage","err","imgFlag","vidFlag","selectedVideo","event","preventDefault","console","log","state","setState","eth","getAccounts","accs","date","Date","setHours","getHours","setMinutes","getMinutes","timestamp","toUTCString","replace","add","ipfsHash","hash","methods","createPost","send","from","value","utils","toWei","th","transactionHash","pushRoute","message","flag","stopPropagation","URL","createObjectURL","target","files","file","reader","window","FileReader","readAsArrayBuffer","onloadend","convertToBuffer","Buffer","result","buffer","onSubmit","captureFile","length","border","borderColor","black","backgroundColor","menuBackground","color","menuText"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport {\n  Form,\n  Button,\n  Input,\n  Image,\n  Message,\n  Container,\n} from \"semantic-ui-react\";\nimport Layout from \"../../components/Layout\";\nimport social from \"../../ethereum/social\";\nimport web3 from \"../../ethereum/web3\";\nimport ipfs from \"../../ethereum/ipfs\";\nimport { Router } from \"../../routes\";\nimport COLORS from \"../../colors\";\nimport ReactPlayer from \"react-player\";\n\nclass NewPost extends Component {\n  state = {\n    caption: \"\",\n    description: \"\",\n    imgBuffer: null,\n    imgIpfsHash: \"\",\n    selectedImage: \"\",\n    loading: false,\n    errMessage: \"\",\n    err: false,\n    imgFlag: true,\n    vidFlag: true,\n    selectedVideo: \"\",\n  };\n\n  onSubmit = async (event) => {\n    event.preventDefault();\n\n    console.log(this.state.imgFlag, this.state.vidFlag);\n    const { description, caption } = this.state;\n\n    this.setState({ loading: true, errMessage: \"\" });\n\n    try {\n      const accs = await web3.eth.getAccounts();\n      const date = new Date();\n      date.setHours(date.getHours() + 5);\n      date.setMinutes(date.getMinutes() + 30);\n      const timestamp = date.toUTCString().replace(\"GMT\", \"IST\");\n\n      console.log(this.state.imgBuffer);\n\n      if (this.state.imgBuffer != null) {\n        const ipfsHash = await ipfs.add(this.state.imgBuffer);\n\n        if(this.state.imgFlag) {\n          this.setState({ imgIpfsHash: \"0\" + ipfsHash[0].hash });\n        }\n        else {\n          this.setState({ imgIpfsHash: \"1\" + ipfsHash[0].hash });\n        }\n      }\n\n      const th = await social.methods\n        .createPost(caption, description, this.state.imgIpfsHash, timestamp)\n        .send({\n          from: accs[0],\n          value: web3.utils.toWei(\"0.01\", \"ether\"),\n        });\n\n      console.log(th.transactionHash);\n      Router.pushRoute(\"/\");\n    } catch (err) {\n      this.setState({ err: true, errMessage: err.message });\n    }\n\n    this.setState({ loading: false });\n  };\n\n  captureFile = (event, flag) => {\n    event.stopPropagation();\n    event.preventDefault();\n\n    if (flag == 0) {\n      this.setState({\n        imgFlag: true,\n        vidFlag: false,\n        selectedImage: URL.createObjectURL(event.target.files[0]),\n      });\n    } else {\n      this.setState({\n        imgFlag: false,\n        vidFlag: true,\n        selectedVideo: URL.createObjectURL(event.target.files[0]),\n      });\n    }\n\n    const file = event.target.files[0];\n    let reader = new window.FileReader();\n    reader.readAsArrayBuffer(file);\n    reader.onloadend = () => this.convertToBuffer(reader);\n  };\n\n  convertToBuffer = async (reader) => {\n    const buffer = await Buffer.from(reader.result);\n\n    this.setState({ imgBuffer: buffer });\n  };\n\n  render() {\n    return (\n      <Layout>\n        <Container>\n          <h3>Create New Post</h3>\n          <hr />\n          <br />\n          <Form onSubmit={this.onSubmit}>\n            <Form.Input\n              fluid\n              label=\"Caption\"\n              value={this.state.caption}\n              onChange={(event) =>\n                this.setState({ caption: event.target.value })\n              }\n            />\n            <Form.Input\n              disabled={!this.state.imgFlag}\n              label=\"Click here to Upload an Image\"\n              type=\"file\"\n              onChange={(event) => this.captureFile(event, 0)}\n            />\n            <Image src={this.state.selectedImage} size=\"medium\" />\n            <br />\n            <Form.Input\n              disabled={!this.state.vidFlag}\n              label=\"Click here to Upload a Video\"\n              type=\"file\"\n              onChange={(event) => this.captureFile(event, 1)}\n            />\n            <ReactPlayer\n              hidden={this.state.selectedVideo.length == 0}\n              style={{ border: \"1px solid\", borderColor: COLORS.black }}\n              url={this.state.selectedVideo}\n              playing\n              controls\n            />\n            <br />\n            <Form.TextArea\n              label=\"Post Description\"\n              value={this.state.description}\n              placeholder=\"Whats Happening...\"\n              onChange={(event) =>\n                this.setState({ description: event.target.value })\n              }\n            />\n\n            <Message\n              error\n              header=\"Oops!\"\n              visible={this.state.err}\n              content={this.state.errMessage}\n            />\n\n            <Button\n              icon=\"edit\"\n              content=\"Create Post\"\n              loading={this.state.loading}\n              style={{\n                backgroundColor: COLORS.menuBackground,\n                color: COLORS.menuText,\n              }}\n            />\n          </Form>\n        </Container>\n      </Layout>\n    );\n  }\n}\n\nexport default NewPost;\n"]},"metadata":{},"sourceType":"module"}