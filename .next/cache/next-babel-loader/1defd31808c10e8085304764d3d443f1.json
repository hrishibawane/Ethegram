{"ast":null,"code":"var _jsxFileName = \"/home/hrishib/Desktop/Ethegram/pages/posts/new.js\";\nvar __jsx = React.createElement;\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport React, { Component } from \"react\";\nimport { Form, Button, Input, Image, Message } from \"semantic-ui-react\";\nimport Layout from \"../../components/Layout\";\nimport social from \"../../ethereum/social\";\nimport web3 from \"../../ethereum/web3\";\nimport ipfs from \"../../ethereum/ipfs\";\nimport { Router } from \"../../routes\";\nimport COLORS from \"../../colors\";\nimport ReactPlayer from \"react-player\";\n\nclass NewPost extends Component {\n  constructor(...args) {\n    super(...args);\n\n    _defineProperty(this, \"state\", {\n      caption: \"\",\n      description: \"\",\n      imgBuffer: null,\n      imgIpfsHash: \"\",\n      selectedImage: \"\",\n      loading: false,\n      errMessage: \"\",\n      err: false,\n      imgFlag: true,\n      vidFlag: true,\n      selectedVideo: \"\"\n    });\n\n    _defineProperty(this, \"onSubmit\", async event => {\n      event.preventDefault();\n      const {\n        description,\n        caption\n      } = this.state;\n      this.setState({\n        loading: true,\n        errMessage: \"\"\n      });\n\n      try {\n        const accs = await web3.eth.getAccounts();\n        const date = new Date();\n        date.setHours(date.getHours() + 5);\n        date.setMinutes(date.getMinutes() + 30);\n        const timestamp = date.toUTCString().replace(\"GMT\", \"IST\");\n        console.log(this.state.imgBuffer);\n\n        if (this.state.imgBuffer != null) {\n          const ipfsHash = await ipfs.add(this.state.imgBuffer);\n          this.setState({\n            imgIpfsHash: ipfsHash[0].hash\n          });\n        }\n\n        const th = await social.methods.createPost(caption, description, this.state.imgIpfsHash, timestamp).send({\n          from: accs[0],\n          value: web3.utils.toWei(\"0.01\", \"ether\")\n        });\n        console.log(th.transactionHash);\n        Router.pushRoute(\"/\");\n      } catch (err) {\n        this.setState({\n          err: true,\n          errMessage: err.message\n        });\n      }\n\n      this.setState({\n        loading: false\n      });\n    });\n\n    _defineProperty(this, \"captureFile\", (event, flag) => {\n      event.stopPropagation();\n      event.preventDefault();\n\n      if (flag == 0) {\n        this.setState({\n          imgFlag: true,\n          vidFlag: false,\n          selectedImage: URL.createObjectURL(event.target.files[0])\n        });\n      } else {\n        this.setState({\n          imgFlag: false,\n          vidFlag: true,\n          selectedVideo: URL.createObjectURL(event.target.files[0])\n        });\n      }\n\n      const file = event.target.files[0];\n      let reader = new window.FileReader();\n      reader.readAsArrayBuffer(file);\n\n      reader.onloadend = () => this.convertToBuffer(reader);\n    });\n\n    _defineProperty(this, \"convertToBuffer\", async reader => {\n      const buffer = await Buffer.from(reader.result);\n      this.setState({\n        imgBuffer: buffer\n      });\n    });\n  }\n\n  render() {\n    return __jsx(Layout, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 88\n      },\n      __self: this\n    }, __jsx(\"h3\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 89\n      },\n      __self: this\n    }, \"Create New Post\"), __jsx(\"hr\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 90\n      },\n      __self: this\n    }), __jsx(\"br\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 91\n      },\n      __self: this\n    }), __jsx(Form, {\n      onSubmit: this.onSubmit,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 92\n      },\n      __self: this\n    }, __jsx(Form.Input, {\n      fluid: true,\n      label: \"Caption\",\n      value: this.state.caption,\n      onChange: event => this.setState({\n        caption: event.target.value\n      }),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 93\n      },\n      __self: this\n    }), __jsx(Form.Input, {\n      disabled: !this.state.imgFlag,\n      label: \"Click here to Upload an Image\",\n      type: \"file\",\n      onChange: event => this.captureFile(event, 0),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 99\n      },\n      __self: this\n    }), __jsx(Image, {\n      src: this.state.selectedImage,\n      size: \"medium\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 105\n      },\n      __self: this\n    }), __jsx(\"br\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 106\n      },\n      __self: this\n    }), __jsx(Form.Input, {\n      disabled: !this.state.vidFlag,\n      label: \"Click here to Upload a Video\",\n      type: \"file\",\n      onChange: event => this.captureFile(event, 1),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 107\n      },\n      __self: this\n    }), __jsx(ReactPlayer, {\n      url: this.state.selectedVideo,\n      playing: true,\n      controls: true,\n      loop: true,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 113\n      },\n      __self: this\n    }), __jsx(\"br\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 119\n      },\n      __self: this\n    }), __jsx(Form.TextArea, {\n      label: \"Post Description\",\n      value: this.state.description,\n      placeholder: \"Whats Happening...\",\n      onChange: event => this.setState({\n        description: event.target.value\n      }),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 120\n      },\n      __self: this\n    }), __jsx(Message, {\n      error: true,\n      header: \"Oops!\",\n      visible: this.state.err,\n      content: this.state.errMessage,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 129\n      },\n      __self: this\n    }), __jsx(Button, {\n      icon: \"edit\",\n      content: \"Create Post\",\n      loading: this.state.loading,\n      style: {\n        backgroundColor: COLORS.menuBackground,\n        color: COLORS.menuText\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 136\n      },\n      __self: this\n    })));\n  }\n\n}\n\nexport default NewPost;","map":{"version":3,"sources":["/home/hrishib/Desktop/Ethegram/pages/posts/new.js"],"names":["React","Component","Form","Button","Input","Image","Message","Layout","social","web3","ipfs","Router","COLORS","ReactPlayer","NewPost","caption","description","imgBuffer","imgIpfsHash","selectedImage","loading","errMessage","err","imgFlag","vidFlag","selectedVideo","event","preventDefault","state","setState","accs","eth","getAccounts","date","Date","setHours","getHours","setMinutes","getMinutes","timestamp","toUTCString","replace","console","log","ipfsHash","add","hash","th","methods","createPost","send","from","value","utils","toWei","transactionHash","pushRoute","message","flag","stopPropagation","URL","createObjectURL","target","files","file","reader","window","FileReader","readAsArrayBuffer","onloadend","convertToBuffer","buffer","Buffer","result","render","onSubmit","captureFile","backgroundColor","menuBackground","color","menuText"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport { Form, Button, Input, Image, Message } from \"semantic-ui-react\";\nimport Layout from \"../../components/Layout\";\nimport social from \"../../ethereum/social\";\nimport web3 from \"../../ethereum/web3\";\nimport ipfs from \"../../ethereum/ipfs\";\nimport { Router } from \"../../routes\";\nimport COLORS from \"../../colors\";\nimport ReactPlayer from \"react-player\";\n\nclass NewPost extends Component {\n  state = {\n    caption: \"\",\n    description: \"\",\n    imgBuffer: null,\n    imgIpfsHash: \"\",\n    selectedImage: \"\",\n    loading: false,\n    errMessage: \"\",\n    err: false,\n    imgFlag: true,\n    vidFlag: true,\n    selectedVideo: \"\"\n  };\n\n  onSubmit = async event => {\n    event.preventDefault();\n\n    const { description, caption } = this.state;\n\n    this.setState({ loading: true, errMessage: \"\" });\n\n    try {\n      const accs = await web3.eth.getAccounts();\n      const date = new Date();\n      date.setHours(date.getHours() + 5);\n      date.setMinutes(date.getMinutes() + 30);\n      const timestamp = date.toUTCString().replace(\"GMT\", \"IST\");\n\n      console.log(this.state.imgBuffer);\n\n      if (this.state.imgBuffer != null) {\n        const ipfsHash = await ipfs.add(this.state.imgBuffer);\n        this.setState({ imgIpfsHash: ipfsHash[0].hash });\n      }\n\n      const th = await social.methods\n        .createPost(caption, description, this.state.imgIpfsHash, timestamp)\n        .send({\n          from: accs[0],\n          value: web3.utils.toWei(\"0.01\", \"ether\")\n        });\n\n      console.log(th.transactionHash);\n      Router.pushRoute(\"/\");\n    } catch (err) {\n      this.setState({ err: true, errMessage: err.message });\n    }\n\n    this.setState({ loading: false });\n  };\n\n  captureFile = (event, flag) => {\n    event.stopPropagation();\n    event.preventDefault();\n\n    if(flag==0) {\n      this.setState({ imgFlag: true, vidFlag: false, selectedImage: URL.createObjectURL(event.target.files[0]) });\n    }\n    else {\n      this.setState({ imgFlag: false, vidFlag: true, selectedVideo: URL.createObjectURL(event.target.files[0]) });\n    }\n\n    const file = event.target.files[0];\n    let reader = new window.FileReader();\n    reader.readAsArrayBuffer(file);\n    reader.onloadend = () => this.convertToBuffer(reader);\n  };\n\n  convertToBuffer = async reader => {\n    const buffer = await Buffer.from(reader.result);\n\n    this.setState({ imgBuffer: buffer });\n  };\n\n  render() {\n    return (\n      <Layout>\n        <h3>Create New Post</h3>\n        <hr />\n        <br />\n        <Form onSubmit={this.onSubmit}>\n          <Form.Input\n            fluid\n            label=\"Caption\"\n            value={this.state.caption}\n            onChange={event => this.setState({ caption: event.target.value })}\n          />\n          <Form.Input\n            disabled={!this.state.imgFlag}\n            label=\"Click here to Upload an Image\"\n            type=\"file\"\n            onChange={event => this.captureFile(event, 0)}\n          />\n          <Image src={this.state.selectedImage} size=\"medium\" />\n          <br />\n          <Form.Input\n            disabled={!this.state.vidFlag}\n            label=\"Click here to Upload a Video\"\n            type=\"file\"\n            onChange={event => this.captureFile(event, 1)}\n          />\n          <ReactPlayer \n            url={this.state.selectedVideo} \n            playing\n            controls\n            loop\n          />\n          <br />\n          <Form.TextArea\n            label=\"Post Description\"\n            value={this.state.description}\n            placeholder=\"Whats Happening...\"\n            onChange={event =>\n              this.setState({ description: event.target.value })\n            }\n          />\n\n          <Message\n            error\n            header=\"Oops!\"\n            visible={this.state.err}\n            content={this.state.errMessage}\n          />\n\n          <Button icon=\"edit\" content=\"Create Post\" loading={this.state.loading} style={{backgroundColor:COLORS.menuBackground, color:COLORS.menuText}} />\n\n        </Form>\n      </Layout>\n    );\n  }\n}\n\nexport default NewPost;\n"]},"metadata":{},"sourceType":"module"}