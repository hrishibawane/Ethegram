{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/esm/inherits\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nvar __jsx = React.createElement;\nimport React, { Component } from \"react\";\nimport { Card, Button, Grid, Image, Form, Modal, Header, List, Input } from \"semantic-ui-react\";\nimport Layout from \"../components/Layout\";\nimport social from \"../ethereum/social\";\nimport web3 from \"../ethereum/web3\";\nimport { Link, Router } from \"../routes\";\nimport ipfs from \"../ethereum/ipfs\";\nimport COLORS from \"../colors\";\n\nvar NewsAPI = require(\"newsapi\");\n\nvar newsapi = new NewsAPI(\"9596f3ac23f5400a981fa2a3e2f8411b\");\n\nvar SocialIndex = /*#__PURE__*/function (_Component) {\n  _inherits(SocialIndex, _Component);\n\n  function SocialIndex() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, SocialIndex);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(SocialIndex)).call.apply(_getPrototypeOf2, [this].concat(args)));\n\n    _defineProperty(_assertThisInitialized(_this), \"state\", {\n      currAccount: \"\",\n      posts: [],\n      postCount: 0,\n      items: [],\n      images: [],\n      newComment: \"\",\n      disabled: false,\n      loading: false,\n      name: \"\",\n      index: 0,\n      username: \"unknown\",\n      done: false,\n      modal: false,\n      articles: [],\n      news: []\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onSubmit\", function _callee(index) {\n      var accs, str;\n      return _regeneratorRuntime.async(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              console.log(index);\n              _context.next = 3;\n              return _regeneratorRuntime.awrap(web3.eth.getAccounts());\n\n            case 3:\n              accs = _context.sent;\n              str = _this.state.username + \": \" + _this.state.newComment;\n              console.log(str);\n              _context.prev = 6;\n              _context.next = 9;\n              return _regeneratorRuntime.awrap(social.methods.postComment(index, str).send({\n                from: accs[0]\n              }));\n\n            case 9:\n              console.log(\"Comment Posted by \" + accs[0]);\n\n              _this.setState({\n                caption: \"\"\n              });\n\n              _context.next = 16;\n              break;\n\n            case 13:\n              _context.prev = 13;\n              _context.t0 = _context[\"catch\"](6);\n              console.log(_context.t0.message);\n\n            case 16:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, null, null, [[6, 13]], Promise);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"likePost\", function _callee2(index) {\n      return _regeneratorRuntime.async(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              console.log(index);\n              _context2.prev = 1;\n              _context2.next = 4;\n              return _regeneratorRuntime.awrap(social.methods.likePost(index).send({\n                from: _this.state.currAccount\n              }));\n\n            case 4:\n              _this.setState({\n                done: true\n              });\n\n              _context2.next = 9;\n              break;\n\n            case 7:\n              _context2.prev = 7;\n              _context2.t0 = _context2[\"catch\"](1);\n\n            case 9:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, null, null, [[1, 7]], Promise);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"signIn\", function _callee3() {\n      return _regeneratorRuntime.async(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              _this.setState({\n                loading: true\n              });\n\n              _context3.next = 3;\n              return _regeneratorRuntime.awrap(social.methods.signIn(_this.state.name).send({\n                from: _this.state.currAccount,\n                value: web3.utils.toWei(\"0.02\", \"ether\")\n              }));\n\n            case 3:\n              _this.setState({\n                loading: false,\n                disabled: true\n              });\n\n            case 4:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"renderArticles\", function () {\n      var articles = _this.state.articles;\n      var news = articles.map(function (article, index) {\n        return {\n          key: index,\n          header: __jsx(\"h4\", null, article.title),\n          description: __jsx(\"p\", {\n            style: {\n              fontSize: \"15px\"\n            }\n          }, article.description),\n          extra: __jsx(\"a\", {\n            href: article.url,\n            target: \"_blank\",\n            style: {\n              color: \"blue\"\n            }\n          }, article.url),\n          fluid: true,\n          style: {\n            backgroundColor: COLORS.background\n          }\n        };\n      });\n\n      _this.setState({\n        news: news\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"renderPosts\", function _callee5() {\n      var posts, items;\n      return _regeneratorRuntime.async(function _callee5$(_context5) {\n        while (1) {\n          switch (_context5.prev = _context5.next) {\n            case 0:\n              posts = _this.state.posts;\n              console.log(_this.state.postCount);\n              _context5.next = 4;\n              return _regeneratorRuntime.awrap(Promise.all(posts.map(function _callee4(post, index) {\n                var name, src, data, bpic;\n                return _regeneratorRuntime.async(function _callee4$(_context4) {\n                  while (1) {\n                    switch (_context4.prev = _context4.next) {\n                      case 0:\n                        _context4.next = 2;\n                        return _regeneratorRuntime.awrap(social.methods.getUserDetails(post.owner).call());\n\n                      case 2:\n                        name = _context4.sent;\n\n                        if (!(post.imgIpfsHash.length > 0)) {\n                          _context4.next = 11;\n                          break;\n                        }\n\n                        _context4.next = 6;\n                        return _regeneratorRuntime.awrap(ipfs.files.get(post.imgIpfsHash));\n\n                      case 6:\n                        data = _context4.sent;\n                        bpic = _this.uint8ToBase64(data[0].content);\n                        src = \"data:image/png;base64,\" + bpic;\n                        _context4.next = 12;\n                        break;\n\n                      case 11:\n                        src = null;\n\n                      case 12:\n                        return _context4.abrupt(\"return\", {\n                          key: index,\n                          header: __jsx(\"div\", null, __jsx(\"h4\", {\n                            style: {\n                              marginBottom: \"0px\"\n                            }\n                          }, name[0]), __jsx(\"p\", {\n                            style: {\n                              color: \"grey\",\n                              marginTop: \"0px\"\n                            }\n                          }, post.timestamp), __jsx(\"h3\", null, post.caption)),\n                          description: __jsx(\"div\", {\n                            style: {\n                              border: \"2px solid grey\"\n                            }\n                          }, __jsx(\"p\", {\n                            style: {\n                              margin: \"10px\",\n                              fontSize: \"15px\"\n                            }\n                          }, post.description), __jsx(Image, {\n                            style: {\n                              padding: \"20px\"\n                            },\n                            hidden: src == null,\n                            src: src,\n                            fluid: true\n                          })),\n                          extra: __jsx(\"div\", null, __jsx(Form, {\n                            onSubmit: function onSubmit() {\n                              return _this.onSubmit(index);\n                            }\n                          }, __jsx(Form.Field, {\n                            inline: true\n                          }, __jsx(Input, {\n                            focus: true,\n                            placeholder: \"Add a comment...\",\n                            value: _this.state.caption,\n                            onChange: function onChange(event) {\n                              return _this.setState({\n                                newComment: event.target.value\n                              });\n                            },\n                            style: {\n                              width: \"70%\",\n                              height: \"40px\",\n                              marginRight: \"0px\"\n                            }\n                          }), __jsx(Button, {\n                            size: \"small\",\n                            color: \"linkedin\",\n                            content: \"Post Comment\",\n                            icon: \"edit\",\n                            style: {\n                              height: \"40px\"\n                            }\n                          }))), __jsx(\"br\", null), __jsx(Button, {\n                            onClick: function onClick() {\n                              return _this.likePost(index);\n                            },\n                            color: \"red\",\n                            content: \"Like\",\n                            icon: \"heart\",\n                            size: \"medium\",\n                            label: {\n                              basic: true,\n                              color: \"red\",\n                              content: post.likes\n                            }\n                          }), __jsx(Modal, {\n                            trigger: __jsx(Button, {\n                              size: \"medium\",\n                              color: \"facebook\",\n                              content: \"View Comments\",\n                              icon: \"comments\",\n                              onClick: function onClick() {\n                                return _this.setState({\n                                  modal: true\n                                });\n                              }\n                            }),\n                            size: \"small\"\n                          }, __jsx(Header, {\n                            content: \"Comments\"\n                          }), __jsx(Modal.Content, null, __jsx(List, {\n                            divided: true,\n                            items: post.comments.split(\"/\")\n                          })), __jsx(Modal.Actions, null, __jsx(Button, {\n                            color: \"red\",\n                            content: \"Close\",\n                            icon: \"close\",\n                            inverted: true,\n                            onClick: function onClick() {\n                              return _this.setState({\n                                modal: false\n                              });\n                            }\n                          })))),\n                          fluid: true\n                        });\n\n                      case 13:\n                      case \"end\":\n                        return _context4.stop();\n                    }\n                  }\n                }, null, null, null, Promise);\n              })));\n\n            case 4:\n              items = _context5.sent;\n\n              _this.setState({\n                items: items\n              });\n\n            case 6:\n            case \"end\":\n              return _context5.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    });\n\n    return _this;\n  }\n\n  _createClass(SocialIndex, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      var accs, isUser, userDetails, username, balance, postCount, posts;\n      return _regeneratorRuntime.async(function componentDidMount$(_context6) {\n        while (1) {\n          switch (_context6.prev = _context6.next) {\n            case 0:\n              _context6.next = 2;\n              return _regeneratorRuntime.awrap(web3.eth.getAccounts());\n\n            case 2:\n              accs = _context6.sent;\n              _context6.next = 5;\n              return _regeneratorRuntime.awrap(social.methods.isUser(accs[0]).call());\n\n            case 5:\n              isUser = _context6.sent;\n              _context6.next = 8;\n              return _regeneratorRuntime.awrap(social.methods.getUserDetails(accs[0]).call());\n\n            case 8:\n              userDetails = _context6.sent;\n              username = userDetails[0];\n              _context6.next = 12;\n              return _regeneratorRuntime.awrap(social.methods.getContractBalance().call());\n\n            case 12:\n              balance = _context6.sent;\n              balance = web3.utils.fromWei(balance, \"ether\");\n              console.log(accs[0], username);\n              console.log(\"Balance: \" + balance);\n              this.setState({\n                disabled: isUser,\n                currAccount: accs[0],\n                username: username\n              });\n              _context6.next = 19;\n              return _regeneratorRuntime.awrap(social.methods.getPostsCount().call());\n\n            case 19:\n              postCount = _context6.sent;\n              _context6.next = 22;\n              return _regeneratorRuntime.awrap(Promise.all(Array(parseInt(postCount)).fill().map(function (element, index) {\n                return social.methods.posts(index).call();\n              })));\n\n            case 22:\n              posts = _context6.sent;\n              this.setState({\n                posts: posts,\n                postCount: postCount\n              });\n              this.renderPosts();\n              newsapi.v2.topHeadlines({\n                language: \"en\",\n                country: \"in\"\n              }).then(function (response) {\n                console.log(response.articles);\n\n                _this2.setState({\n                  articles: response.articles\n                });\n\n                _this2.renderArticles();\n              });\n\n            case 26:\n            case \"end\":\n              return _context6.stop();\n          }\n        }\n      }, null, this, null, Promise);\n    }\n  }, {\n    key: \"uint8ToBase64\",\n    value: function uint8ToBase64(buffer) {\n      var binary = \"\";\n      var bytes = [].slice.call(new Uint8Array(buffer));\n      bytes.forEach(function (b) {\n        return binary += String.fromCharCode(b);\n      });\n      return window.btoa(binary);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this3 = this;\n\n      return __jsx(Layout, null, __jsx(\"h2\", null, \"Posts\"), __jsx(Grid, null, __jsx(Grid.Column, {\n        width: 11,\n        style: {\n          marginRight: \"10px\",\n          paddingRight: \"20px\"\n        }\n      }, __jsx(Card.Group, {\n        centered: true,\n        items: this.state.items\n      })), __jsx(Grid.Column, {\n        width: 4,\n        textAlign: \"left\",\n        style: {\n          marginLeft: \"40px\",\n          marginTop: \"15px\",\n          border: \"1px solid #A9A9A9\",\n          borderRadius: \"5px\",\n          backgroundColor: COLORS.white\n        }\n      }, __jsx(Form, {\n        style: {\n          backgroundColor: COLORS.background,\n          padding: \"10px\",\n          border: \"1px solid #A9A9A9\"\n        }\n      }, __jsx(\"label\", null, __jsx(\"h4\", {\n        style: {\n          color: COLORS.menuBackground\n        }\n      }, \"Name:\")), __jsx(Form.Input, {\n        style: {\n          marginTop: \"5px\"\n        },\n        disabled: this.state.disabled,\n        fluid: true,\n        value: this.state.name,\n        onChange: function onChange(event) {\n          return _this3.setState({\n            name: event.target.value\n          });\n        }\n      }), __jsx(Button, {\n        size: \"medium\",\n        content: \"Sign In\",\n        onClick: this.signIn,\n        style: {\n          backgroundColor: COLORS.menuBackground,\n          color: COLORS.menuText,\n          width: \"100%\"\n        },\n        disabled: this.state.disabled,\n        loading: this.state.loading\n      })), __jsx(\"br\", null), __jsx(Link, {\n        route: \"/profile\"\n      }, __jsx(\"a\", {\n        style: {\n          color: COLORS.menuBackground\n        }\n      }, __jsx(\"h4\", null, \"Signed in as \", this.state.username))), __jsx(\"br\", null), __jsx(Link, {\n        route: \"/posts/new\"\n      }, __jsx(\"a\", null, __jsx(Button, {\n        content: \"Create New Post\",\n        size: \"medium\",\n        style: {\n          backgroundColor: COLORS.menuBackground,\n          color: COLORS.menuText,\n          width: \"100%\"\n        },\n        disabled: !this.state.disabled\n      }))), __jsx(\"br\", null), __jsx(\"br\", null), __jsx(\"hr\", null), __jsx(\"h3\", {\n        style: {\n          marginBottom: \"0px\",\n          color: COLORS.menuBackground\n        }\n      }, \"News Updates\"), __jsx(\"p\", {\n        style: {\n          color: \"grey\",\n          marginBottom: \"20px\"\n        }\n      }, \"Powered by newsapi.org\"), __jsx(Card.Group, {\n        items: this.state.news\n      }))));\n    }\n  }]);\n\n  return SocialIndex;\n}(Component);\n\nexport default SocialIndex;","map":null,"metadata":{},"sourceType":"module"}