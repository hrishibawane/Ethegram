{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/esm/inherits\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nvar _jsxFileName = \"/home/hrishib/Desktop/Ethegram/pages/posts/new.js\";\nvar __jsx = React.createElement;\nimport React, { Component } from \"react\";\nimport { Form, Button, Input, Image, Message } from \"semantic-ui-react\";\nimport Layout from \"../../components/Layout\";\nimport social from \"../../ethereum/social\";\nimport web3 from \"../../ethereum/web3\";\nimport ipfs from \"../../ethereum/ipfs\";\nimport { Router } from \"../../routes\";\nimport COLORS from \"../../colors\";\nimport ReactPlayer from \"react-player\";\n\nvar NewPost = /*#__PURE__*/function (_Component) {\n  _inherits(NewPost, _Component);\n\n  function NewPost() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, NewPost);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(NewPost)).call.apply(_getPrototypeOf2, [this].concat(args)));\n\n    _defineProperty(_assertThisInitialized(_this), \"state\", {\n      caption: \"\",\n      description: \"\",\n      imgBuffer: null,\n      imgIpfsHash: \"\",\n      selectedImage: \"\",\n      loading: false,\n      errMessage: \"\",\n      err: false,\n      imgFlag: true,\n      vidFlag: true,\n      selectedVideo: \"https://www.google.com/url?sa=i&url=https%3A%2F%2Fgiphy.com%2Fgifs%2Fwelcome-OkJat1YNdoD3W&psig=AOvVaw3eFidEvYh36-I6qT7YScal&ust=1586351820403000&source=images&cd=vfe&ved=0CAIQjRxqFwoTCPjJ95ez1ugCFQAAAAAdAAAAABAR\"\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onSubmit\", function _callee(event) {\n      var _this$state, description, caption, accs, date, timestamp, ipfsHash, th;\n\n      return _regeneratorRuntime.async(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              event.preventDefault();\n              _this$state = _this.state, description = _this$state.description, caption = _this$state.caption;\n\n              _this.setState({\n                loading: true,\n                errMessage: \"\"\n              });\n\n              _context.prev = 3;\n              _context.next = 6;\n              return _regeneratorRuntime.awrap(web3.eth.getAccounts());\n\n            case 6:\n              accs = _context.sent;\n              date = new Date();\n              date.setHours(date.getHours() + 5);\n              date.setMinutes(date.getMinutes() + 30);\n              timestamp = date.toUTCString().replace(\"GMT\", \"IST\");\n              console.log(_this.state.imgBuffer);\n\n              if (!(_this.state.imgBuffer != null)) {\n                _context.next = 17;\n                break;\n              }\n\n              _context.next = 15;\n              return _regeneratorRuntime.awrap(ipfs.add(_this.state.imgBuffer));\n\n            case 15:\n              ipfsHash = _context.sent;\n\n              _this.setState({\n                imgIpfsHash: ipfsHash[0].hash\n              });\n\n            case 17:\n              _context.next = 19;\n              return _regeneratorRuntime.awrap(social.methods.createPost(caption, description, _this.state.imgIpfsHash, timestamp).send({\n                from: accs[0],\n                value: web3.utils.toWei(\"0.01\", \"ether\")\n              }));\n\n            case 19:\n              th = _context.sent;\n              console.log(th.transactionHash);\n              Router.pushRoute(\"/\");\n              _context.next = 27;\n              break;\n\n            case 24:\n              _context.prev = 24;\n              _context.t0 = _context[\"catch\"](3);\n\n              _this.setState({\n                err: true,\n                errMessage: _context.t0.message\n              });\n\n            case 27:\n              _this.setState({\n                loading: false\n              });\n\n            case 28:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, null, null, [[3, 24]], Promise);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"captureFile\", function (event, flag) {\n      event.stopPropagation();\n      event.preventDefault();\n\n      if (flag == 0) {\n        _this.setState({\n          imgFlag: true,\n          vidFlag: false,\n          selectedImage: URL.createObjectURL(event.target.files[0])\n        });\n      } else {\n        _this.setState({\n          imgFlag: false,\n          vidFlag: true,\n          selectedVideo: URL.createObjectURL(event.target.files[0])\n        });\n      }\n\n      var file = event.target.files[0];\n      var reader = new window.FileReader();\n      reader.readAsArrayBuffer(file);\n\n      reader.onloadend = function () {\n        return _this.convertToBuffer(reader);\n      };\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"convertToBuffer\", function _callee2(reader) {\n      var buffer;\n      return _regeneratorRuntime.async(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.next = 2;\n              return _regeneratorRuntime.awrap(Buffer.from(reader.result));\n\n            case 2:\n              buffer = _context2.sent;\n\n              _this.setState({\n                imgBuffer: buffer\n              });\n\n            case 4:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    });\n\n    return _this;\n  }\n\n  _createClass(NewPost, [{\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      return __jsx(Layout, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 88\n        },\n        __self: this\n      }, __jsx(\"h3\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 89\n        },\n        __self: this\n      }, \"Create New Post\"), __jsx(\"hr\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 90\n        },\n        __self: this\n      }), __jsx(\"br\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 91\n        },\n        __self: this\n      }), __jsx(Form, {\n        onSubmit: this.onSubmit,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 92\n        },\n        __self: this\n      }, __jsx(Form.Input, {\n        fluid: true,\n        label: \"Caption\",\n        value: this.state.caption,\n        onChange: function onChange(event) {\n          return _this2.setState({\n            caption: event.target.value\n          });\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 93\n        },\n        __self: this\n      }), __jsx(Form.Input, {\n        disabled: !this.state.imgFlag,\n        label: \"Click here to Upload an Image\",\n        type: \"file\",\n        onChange: function onChange(event) {\n          return _this2.captureFile(event, 0);\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 99\n        },\n        __self: this\n      }), __jsx(Image, {\n        src: this.state.selectedImage,\n        size: \"medium\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 105\n        },\n        __self: this\n      }), __jsx(\"br\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 106\n        },\n        __self: this\n      }), __jsx(Form.Input, {\n        disabled: !this.state.vidFlag,\n        label: \"Click here to Upload a Video\",\n        type: \"file\",\n        onChange: function onChange(event) {\n          return _this2.captureFile(event, 1);\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 107\n        },\n        __self: this\n      }), __jsx(ReactPlayer, {\n        url: this.state.selectedVideo,\n        playing: true,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 113\n        },\n        __self: this\n      }), __jsx(\"br\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 114\n        },\n        __self: this\n      }), __jsx(Form.TextArea, {\n        label: \"Post Description\",\n        value: this.state.description,\n        placeholder: \"Whats Happening...\",\n        onChange: function onChange(event) {\n          return _this2.setState({\n            description: event.target.value\n          });\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 115\n        },\n        __self: this\n      }), __jsx(Message, {\n        error: true,\n        header: \"Oops!\",\n        visible: this.state.err,\n        content: this.state.errMessage,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 124\n        },\n        __self: this\n      }), __jsx(Button, {\n        icon: \"edit\",\n        content: \"Create Post\",\n        loading: this.state.loading,\n        style: {\n          backgroundColor: COLORS.menuBackground,\n          color: COLORS.menuText\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 131\n        },\n        __self: this\n      })));\n    }\n  }]);\n\n  return NewPost;\n}(Component);\n\nexport default NewPost;","map":{"version":3,"sources":["/home/hrishib/Desktop/Ethegram/pages/posts/new.js"],"names":["React","Component","Form","Button","Input","Image","Message","Layout","social","web3","ipfs","Router","COLORS","ReactPlayer","NewPost","caption","description","imgBuffer","imgIpfsHash","selectedImage","loading","errMessage","err","imgFlag","vidFlag","selectedVideo","event","preventDefault","state","setState","eth","getAccounts","accs","date","Date","setHours","getHours","setMinutes","getMinutes","timestamp","toUTCString","replace","console","log","add","ipfsHash","hash","methods","createPost","send","from","value","utils","toWei","th","transactionHash","pushRoute","message","flag","stopPropagation","URL","createObjectURL","target","files","file","reader","window","FileReader","readAsArrayBuffer","onloadend","convertToBuffer","Buffer","result","buffer","onSubmit","captureFile","backgroundColor","menuBackground","color","menuText"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport { Form, Button, Input, Image, Message } from \"semantic-ui-react\";\nimport Layout from \"../../components/Layout\";\nimport social from \"../../ethereum/social\";\nimport web3 from \"../../ethereum/web3\";\nimport ipfs from \"../../ethereum/ipfs\";\nimport { Router } from \"../../routes\";\nimport COLORS from \"../../colors\";\nimport ReactPlayer from \"react-player\";\n\nclass NewPost extends Component {\n  state = {\n    caption: \"\",\n    description: \"\",\n    imgBuffer: null,\n    imgIpfsHash: \"\",\n    selectedImage: \"\",\n    loading: false,\n    errMessage: \"\",\n    err: false,\n    imgFlag: true,\n    vidFlag: true,\n    selectedVideo: \"https://www.google.com/url?sa=i&url=https%3A%2F%2Fgiphy.com%2Fgifs%2Fwelcome-OkJat1YNdoD3W&psig=AOvVaw3eFidEvYh36-I6qT7YScal&ust=1586351820403000&source=images&cd=vfe&ved=0CAIQjRxqFwoTCPjJ95ez1ugCFQAAAAAdAAAAABAR\"\n  };\n\n  onSubmit = async event => {\n    event.preventDefault();\n\n    const { description, caption } = this.state;\n\n    this.setState({ loading: true, errMessage: \"\" });\n\n    try {\n      const accs = await web3.eth.getAccounts();\n      const date = new Date();\n      date.setHours(date.getHours() + 5);\n      date.setMinutes(date.getMinutes() + 30);\n      const timestamp = date.toUTCString().replace(\"GMT\", \"IST\");\n\n      console.log(this.state.imgBuffer);\n\n      if (this.state.imgBuffer != null) {\n        const ipfsHash = await ipfs.add(this.state.imgBuffer);\n        this.setState({ imgIpfsHash: ipfsHash[0].hash });\n      }\n\n      const th = await social.methods\n        .createPost(caption, description, this.state.imgIpfsHash, timestamp)\n        .send({\n          from: accs[0],\n          value: web3.utils.toWei(\"0.01\", \"ether\")\n        });\n\n      console.log(th.transactionHash);\n      Router.pushRoute(\"/\");\n    } catch (err) {\n      this.setState({ err: true, errMessage: err.message });\n    }\n\n    this.setState({ loading: false });\n  };\n\n  captureFile = (event, flag) => {\n    event.stopPropagation();\n    event.preventDefault();\n\n    if(flag==0) {\n      this.setState({ imgFlag: true, vidFlag: false, selectedImage: URL.createObjectURL(event.target.files[0]) });\n    }\n    else {\n      this.setState({ imgFlag: false, vidFlag: true, selectedVideo: URL.createObjectURL(event.target.files[0]) });\n    }\n\n    const file = event.target.files[0];\n    let reader = new window.FileReader();\n    reader.readAsArrayBuffer(file);\n    reader.onloadend = () => this.convertToBuffer(reader);\n  };\n\n  convertToBuffer = async reader => {\n    const buffer = await Buffer.from(reader.result);\n\n    this.setState({ imgBuffer: buffer });\n  };\n\n  render() {\n    return (\n      <Layout>\n        <h3>Create New Post</h3>\n        <hr />\n        <br />\n        <Form onSubmit={this.onSubmit}>\n          <Form.Input\n            fluid\n            label=\"Caption\"\n            value={this.state.caption}\n            onChange={event => this.setState({ caption: event.target.value })}\n          />\n          <Form.Input\n            disabled={!this.state.imgFlag}\n            label=\"Click here to Upload an Image\"\n            type=\"file\"\n            onChange={event => this.captureFile(event, 0)}\n          />\n          <Image src={this.state.selectedImage} size=\"medium\" />\n          <br />\n          <Form.Input\n            disabled={!this.state.vidFlag}\n            label=\"Click here to Upload a Video\"\n            type=\"file\"\n            onChange={event => this.captureFile(event, 1)}\n          />\n          <ReactPlayer url={this.state.selectedVideo} playing/>\n          <br />\n          <Form.TextArea\n            label=\"Post Description\"\n            value={this.state.description}\n            placeholder=\"Whats Happening...\"\n            onChange={event =>\n              this.setState({ description: event.target.value })\n            }\n          />\n\n          <Message\n            error\n            header=\"Oops!\"\n            visible={this.state.err}\n            content={this.state.errMessage}\n          />\n\n          <Button icon=\"edit\" content=\"Create Post\" loading={this.state.loading} style={{backgroundColor:COLORS.menuBackground, color:COLORS.menuText}} />\n\n        </Form>\n      </Layout>\n    );\n  }\n}\n\nexport default NewPost;\n"]},"metadata":{},"sourceType":"module"}